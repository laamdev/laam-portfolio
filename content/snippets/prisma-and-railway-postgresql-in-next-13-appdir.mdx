---
title: Prisma and Railway PostgreSQL in Next 13 AppDir
publishedAt: "2023-01-02"
summary: Setting up a fullstack application with Prisma and a PostgresSQL database in Railway using the Next 13 app directory.
---

xxx

---

1. Create Next 13 repo with experimental app directory

```
pnpm dlx create-next-app@latest --experimental-app
```

2. Install and setup Taiwlind CSS

```
pnpm install -D tailwindcss postcss autroprefixer
```

```
pnpm dlx tailwind init -p
```

```js
/* tailwind.config.js */
module.exports = {
  content: [
    "./app/**/*.{js,ts,jsx,tsx}",
    "./pages/**/*.{js,ts,jsx,tsx}",
    "./components/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

3. Create Provision PostgreSQL in Railway

4. Add Prisma

```
pnpm i prisma typescript ts-node @types/node --save-dev
```

```
pnpm dlx prisma init
```

5. Add the postgres connection URL as an env variable. It can be found in the connect tab of the railway postgreSQL database

```js
/* .env */

DATABASE_URL =
  "postgresql://postgres:xxxx@containers-us-west-160.railway.app:6970/railway"
```

6. Create schemas in the schema.prisma

```prisma
model Post {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String   @db.VarChar(255)
  content   String?
  published Boolean  @default(false)
}
```

7. Install prisma client

```
pnpm i @prisma/client
```

8. Create client.js in the prisma folder to instantiate the prisma client

9. Migrate the local prisma schema changes to the railway database models

```
pnpm dlx prisma migrate dev
```

10. Install next-auth and create a route

```
pnpm i next-auth
```

```
/* pages/api/auth/[...nexauth].js */
pnpm i next-auth
```

11. Install next-auth prisma adapter

```
pnpm i next-auth @prisma/client @next-auth/prisma-adapter
pnpm i prisma --save-dev
```

12. Create and app and an OAuth client ID in the Google Developer Console. Remember to add the callback URL

```
http://localhost:3000/api/auth/callback/google
```

13. Add the sign in client IDs as variables to the env.local file

```
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
```

14. Add the next-auth models to the schema.prisma

---

Resources

1. [Prisma + Postgres Setup Guide](https://www.prisma.io/docs/getting-started/setup-prisma/start-from-scratch/relational-databases/using-prisma-migrate-typescript-postgres)

2. [NextAuth installation guide](https://next-auth.js.org/getting-started/example)

3. [NextAuth Prisma adapter](https://next-auth.js.org/v3/adapters/prisma)

4. [NextAuth Google provider](https://next-auth.js.org/providers/google)
